version: '3.9'

services:
  database:
    image: postgres
    restart: always
    environment:
        POSTGRES_USER: postgres
        POSTGRES_PASSWORD: password
        POSTGRES_DB: tma
    ports:
        - "5432:5432"
    volumes:
        - db:/var/lib/postgresql/data

  client:
    container_name: client
    build:
        context: ./client
        dockerfile: Dockerfile
    volumes:
      - static:/app/dist

  server:
    container_name: server
    environment:
      - TONPROOF_PAYLOAD_SIGNATURE_KEY=value
    build:
      context: ./server
      dockerfile: Dockerfile
    depends_on:
      - database
    ports:
      - "8081:8081"
    volumes:
      - static:/app/static
    links:
      - "database"

volumes:
  static:
  db:
    driver: local